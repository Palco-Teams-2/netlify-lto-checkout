<!-- Indicators LTO Checkout • Self-Contained Embed (Combo Plans) -->
<section id="indicators-checkout">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    #indicators-checkout {
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #1a1a1a;
      line-height: 1.5;
      box-sizing: border-box;
    }

    #indicators-checkout *, #indicators-checkout *::before, #indicators-checkout *::after {
      box-sizing: border-box;
    }

    #indicators-checkout .wrap {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px;
    }

    #indicators-checkout .checkout-card {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 32px;
    }

    #indicators-checkout .separator {
      height: 1px;
      background: linear-gradient(90deg, transparent, #e0e0e0, transparent);
      margin: 18px 0;
    }

    /* Addons Section */
    #indicators-checkout .addons-section {
      margin-bottom: 24px;
    }

    #indicators-checkout .addons-label {
      font-size: 12px;
      font-weight: 600;
      color: #666666;
      margin: 0 0 12px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Addon Cards */
    #indicators-checkout .addon-card {
      display: grid;
      grid-template-columns: 64px 1fr 48px;
      align-items: flex-start;
      gap: 26px;
      padding: 16px;
      background: transparent;
      border: 2.5px dashed #4a90e2;
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      position: relative;
      overflow: visible;
    }

    #indicators-checkout .addon-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, #ffffff 0%, #ffffff 15%, rgba(34, 197, 94, 0.03) 15%, rgba(34, 197, 94, 0.03) 100%);
      pointer-events: none;
      border-radius: 12px;
      z-index: -1;
    }

    #indicators-checkout .addon-card:hover::before {
      background: linear-gradient(90deg, #ffffff 0%, #ffffff 15%, rgba(34, 197, 94, 0.06) 15%, rgba(34, 197, 94, 0.06) 100%);
    }

    #indicators-checkout .addon-card:hover {
      border-color: #2563eb;
    }

    #indicators-checkout .addon-card.selected {
      border-color: #0052cc;
      border-style: solid;
    }

    /* Addon Icon */
    #indicators-checkout .addon-icon {
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #f5f5f5 0%, #efefef 100%);
      border-radius: 10px;
      flex-shrink: 0;
      grid-column: 1;
      grid-row: 1;
      overflow: hidden;
    }

    /* Addon Content */
    #indicators-checkout .addon-content {
      grid-column: 2;
      grid-row: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    #indicators-checkout .addon-title {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0;
      line-height: 1.3;
    }

    #indicators-checkout .addon-pricing {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
    }

    #indicators-checkout .addon-price-current {
      font-size: 16px;
      font-weight: 700;
      color: #0052cc;
    }

    #indicators-checkout .addon-price-original {
      font-size: 14px;
      font-weight: 500;
      color: #9ca3af;
      text-decoration: line-through;
    }

    #indicators-checkout .addon-details {
      font-size: 10.8px;
      color: #0052cc;
      text-decoration: none;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      width: fit-content;
      margin-top: 0;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }

    #indicators-checkout .addon-details:hover {
      text-decoration: underline;
    }

    #indicators-checkout .addon-details .info-icon {
      flex-shrink: 0;
      width: 14px;
      height: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1.5px solid #0052cc;
      border-radius: 50%;
      font-size: 9px;
      font-weight: 700;
      font-style: normal;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #0052cc;
      line-height: 1;
      text-align: center;
    }

    /* Expanded Content */
    #indicators-checkout .addon-expanded-content {
      display: none;
      grid-column: 1 / -1;
      margin-top: 0;
      padding: 12px 16px;
      border-top: 1px solid #e0e0e0;
      position: relative;
      background: #ffffff;
      margin-left: -16px;
      margin-right: -16px;
    }

    #indicators-checkout .addon-card.expanded .addon-expanded-content {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #indicators-checkout .addon-expanded-text {
      font-size: 12px;
      color: #666666;
      line-height: 1.5;
      margin-top: 8px;
      padding-right: 16px;
    }

    #indicators-checkout .addon-close-btn {
      background: none;
      border: none;
      font-size: 20px;
      color: #d0d0d0;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
      position: absolute;
      top: 12px;
      right: 16px;
    }

    #indicators-checkout .addon-close-btn:hover {
      color: #999;
    }

    /* Addon Checkbox Button */
    #indicators-checkout .addon-checkbox {
      width: 26px;
      height: 26px;
      border-radius: 4px;
      background: white;
      border: 2px solid #d0d0d0;
      color: white;
      cursor: pointer;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      grid-column: 3;
      grid-row: 1;
      margin-left: -10px;
      margin-top: 16px;
      padding: 0;
      position: relative;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      font-weight: bold;
      line-height: 1;
    }

    #indicators-checkout .addon-checkbox::before {
      content: '';
      position: absolute;
      left: -28px;
      width: 20px;
      height: 20px;
      background: #ef4444;
      clip-path: polygon(0 20%, 50% 20%, 50% 0%, 100% 50%, 50% 100%, 50% 80%, 0 80%);
      top: 50%;
      transform: translateY(-50%);
      z-index: 2;
      animation: arrowBounce 1.5s ease-in-out infinite;
    }

    @keyframes arrowBounce {
      0%, 100% {
        transform: translateY(-50%) translateX(0);
      }
      50% {
        transform: translateY(-50%) translateX(6px);
      }
    }

    #indicators-checkout .addon-checkbox:hover {
      border-color: #b0b0b0;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    #indicators-checkout .addon-checkbox.checked {
      background: #0052cc;
      border-color: #0052cc;
      color: white;
    }

    #indicators-checkout .addon-checkbox.checked::before {
      display: none;
    }

    #indicators-checkout .addon-checkbox.checked::after {
      content: '';
      display: block;
      position: absolute;
      width: 14px;
      height: 10px;
      border-left: 2.5px solid white;
      border-bottom: 2.5px solid white;
      border-radius: 2px;
      transform: rotate(-45deg);
      top: 5px;
      left: 5px;
    }

    /* Main Checkout Container */
    #indicators-checkout .checkout-container {
      min-height: 400px;
      padding: 13px 0;
    }

    #indicators-checkout .loading-text {
      text-align: center;
      font-size: 12px;
      color: #666666;
      font-style: italic;
      margin: 12px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      #indicators-checkout .checkout-card {
        padding: 20px;
      }

      #indicators-checkout .addon-card {
        grid-template-columns: 50px 1fr 40px;
        gap: 12px;
        padding: 12px;
      }

      #indicators-checkout .addon-icon {
        width: 50px;
        height: 50px;
      }

      #indicators-checkout .addon-icon svg {
        width: 40px;
        height: 40px;
      }

      #indicators-checkout .addon-title {
        font-size: 13px;
      }

      #indicators-checkout .addon-checkbox {
        margin-left: -5px;
        margin-top: 10px;
      }

      #indicators-checkout .addon-checkbox::before {
        left: -24px;
        width: 16px;
        height: 16px;
      }
    }
  </style>

  <div class="wrap">
    <div class="checkout-card">
      
      <!-- Add-ons Section (Top) -->
      <div class="addons-section">

        <!-- Risk Calculator Addon -->
        <div class="addon-card" data-addon="riskCalc">
          <div class="addon-icon">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="4" y="4" width="32" height="32" rx="6" fill="#e5e7eb"/>
              <rect x="10" y="12" width="20" height="16" rx="2" fill="#9ca3af"/>
              <rect x="13" y="15" width="6" height="4" rx="1" fill="#d1d5db"/>
              <rect x="21" y="15" width="6" height="4" rx="1" fill="#d1d5db"/>
              <rect x="13" y="21" width="6" height="4" rx="1" fill="#d1d5db"/>
              <rect x="21" y="21" width="6" height="4" rx="1" fill="#d1d5db"/>
            </svg>
          </div>
          <div class="addon-content">
            <h4 class="addon-title">TJR's Risk Management Calculator</h4>
            <div class="addon-pricing">
              <span class="addon-price-current">$27</span>
              <span class="addon-price-original">$79</span>
            </div>
            <button class="addon-details" data-toggle-details="riskCalc">
              <span class="info-icon">i</span>
              Get more details
            </button>
          </div>
          <button class="addon-checkbox" data-addon-checkbox="riskCalc" type="button"></button>
          <div class="addon-expanded-content">
            <button class="addon-close-btn" data-close-details="riskCalc" type="button" aria-label="Close details">×</button>
            <div class="addon-expanded-text">
              The ultimate solution for optimizing your trading decisions. Perfect for everyday use, it provides long-lasting insights and protection against market volatility. Equipped with advanced algorithms and real-time data analysis, this tool helps you identify potential risks and maximize your trading potential across multiple strategies and timeframes.
            </div>
          </div>
        </div>

        <!-- Trading Journal Addon -->
        <div class="addon-card" data-addon="tradingJournal">
          <div class="addon-icon">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="4" y="4" width="32" height="32" rx="6" fill="#e5e7eb"/>
              <rect x="10" y="10" width="20" height="20" rx="2" fill="#9ca3af"/>
              <line x1="14" y1="15" x2="26" y2="15" stroke="#d1d5db" stroke-width="2" stroke-linecap="round"/>
              <line x1="14" y1="20" x2="26" y2="20" stroke="#d1d5db" stroke-width="2" stroke-linecap="round"/>
              <line x1="14" y1="25" x2="22" y2="25" stroke="#d1d5db" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="addon-content">
            <h4 class="addon-title">TJR's Trading Journal 2.0</h4>
            <div class="addon-pricing">
              <span class="addon-price-current">$47</span>
              <span class="addon-price-original">$199</span>
            </div>
            <button class="addon-details" data-toggle-details="tradingJournal">
              <span class="info-icon">i</span>
              Get more details
            </button>
          </div>
          <button class="addon-checkbox" data-addon-checkbox="tradingJournal" type="button"></button>
          <div class="addon-expanded-content">
            <button class="addon-close-btn" data-close-details="tradingJournal" type="button" aria-label="Close details">×</button>
            <div class="addon-expanded-text">
              Track every trade with precision using our comprehensive trading journal platform. Record detailed entries for each trade, analyze patterns, and optimize your strategy over time. Features include real-time performance metrics, win/loss analysis, and customizable templates to help you maintain consistency and improve your trading discipline and profitability.
            </div>
          </div>
        </div>
      </div>

      <div class="separator"></div>

      <!-- Main Product Checkout (Bottom) -->
      <div class="checkout-container">
        <div class="loading-text" id="main-loading">Loading secure checkout…</div>
        <div id="whop-checkout-mount">
          <!-- Initial embed - Whop script will find this on load -->
          <div 
            data-whop-checkout-plan-id="plan_H3aw3n7IvJDzN"
            data-whop-checkout-theme="light"
            data-whop-checkout-return-url=""
            data-whop-checkout-hide-price="true"
            data-whop-checkout-hide-tos="true"
            data-whop-checkout-hide-email="true"
            data-whop-checkout-prefill-email="adrianpaleka@gmail.com"
          ></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ===== Plan Configuration (Combo Plans) =====
    const PLAN_MAP = {
      // [riskCalc, tradingJournal] → planId
      'false,false': 'plan_H3aw3n7IvJDzN',      // Main only
      'true,false':  'plan_yOnczbRi8luJR',      // Main + Risk Calculator
      'false,true':  'plan_0RuJva4sozlDt',      // Main + Trading Journal
      'true,true':   'plan_BGTaQDcKjWjCb'       // Main + Both
    };

    // ===== State =====
    const state = {
      addons: {
        riskCalc: false,
        tradingJournal: false
      },
      expandedDetails: {
        riskCalc: false,
        tradingJournal: false
      }
    };

    // ===== DOM Helpers =====
    const qs = (sel) => document.querySelector(sel);
    const qsa = (sel) => Array.from(document.querySelectorAll(sel));

    // ===== Get Current Plan ID Based on Selection =====
    function getCurrentPlanId() {
      const key = `${state.addons.riskCalc},${state.addons.tradingJournal}`;
      return PLAN_MAP[key] || PLAN_MAP['false,false'];
    }

    // ===== Mount/Update Whop Checkout =====
    function mountWhopCheckout() {
      const container = qs('#whop-checkout-mount');
      if (!container) return;

      const planId = getCurrentPlanId();
      
      // Clear and recreate - Whop auto-detects new embeds
      container.innerHTML = '';
      
      const embedDiv = document.createElement('div');
      embedDiv.setAttribute('data-whop-checkout-plan-id', planId);
      embedDiv.setAttribute('data-whop-checkout-theme', 'light');
      embedDiv.setAttribute('data-whop-checkout-return-url', window.location.href);
      embedDiv.setAttribute('data-whop-checkout-hide-price', 'true');
      embedDiv.setAttribute('data-whop-checkout-hide-tos', 'true');
      embedDiv.setAttribute('data-whop-checkout-hide-email', 'true');
      embedDiv.setAttribute('data-whop-checkout-prefill-email', 'adrianpaleka@gmail.com');
      
      container.appendChild(embedDiv);

      // Hide loading indicator once iframe appears
      hideLoadingWhenReady();
    }

    // ===== Hide Loading When Ready =====
    function hideLoadingWhenReady() {
      const loadingEl = qs('#main-loading');
      const container = qs('#whop-checkout-mount');
      if (!loadingEl || !container) return;

      let tries = 0;
      (function waitForIframe() {
        const hasIframe = container.querySelector('iframe');
        if (hasIframe) {
          loadingEl.style.display = 'none';
          return;
        }
        if (tries++ < 50) {
          setTimeout(waitForIframe, 200);
        }
      })();
    }

    // ===== Toggle Addon Selection =====
    function toggleAddon(addonKey) {
      state.addons[addonKey] = !state.addons[addonKey];
      
      // Update UI
      const card = qs(`[data-addon="${addonKey}"]`);
      const checkbox = qs(`[data-addon-checkbox="${addonKey}"]`);
      
      if (card) card.classList.toggle('selected', state.addons[addonKey]);
      if (checkbox) checkbox.classList.toggle('checked', state.addons[addonKey]);
      
      // Show loading again while checkout updates
      const loadingEl = qs('#main-loading');
      if (loadingEl) loadingEl.style.display = 'block';
      
      // Update Whop checkout with new plan
      mountWhopCheckout();
    }

    // ===== Toggle Details Expansion =====
    function toggleDetails(addonKey) {
      state.expandedDetails[addonKey] = !state.expandedDetails[addonKey];
      const card = qs(`[data-addon="${addonKey}"]`);
      if (card) card.classList.toggle('expanded', state.expandedDetails[addonKey]);
    }

    function closeDetails(addonKey) {
      state.expandedDetails[addonKey] = false;
      const card = qs(`[data-addon="${addonKey}"]`);
      if (card) card.classList.remove('expanded');
    }

    // ===== Event Binding =====
    function bindEvents() {
      // Addon checkbox buttons
      qsa('[data-addon-checkbox]').forEach(btn => {
        btn.addEventListener('click', () => {
          toggleAddon(btn.dataset.addonCheckbox);
        });
      });

      // Toggle details buttons
      qsa('[data-toggle-details]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          toggleDetails(btn.dataset.toggleDetails);
        });
      });

      // Close details buttons
      qsa('[data-close-details]').forEach(btn => {
        btn.addEventListener('click', () => {
          closeDetails(btn.dataset.closeDetails);
        });
      });
    }

    // ===== Initialization =====
    function init() {
      bindEvents();
      
      // Set return URL on initial embed (can't be set in HTML since we need window.location)
      const initialEmbed = qs('#whop-checkout-mount > div');
      if (initialEmbed) {
        initialEmbed.setAttribute('data-whop-checkout-return-url', window.location.href);
      }
      
      // Hide loading when iframe appears
      hideLoadingWhenReady();
    }

    // ===== Run =====
    if (document.readyState !== 'loading') {
      init();
    } else {
      document.addEventListener('DOMContentLoaded', init);
    }
  </script>

  <!-- Whop Checkout Loader -->
  <script async defer src="https://js.whop.com/static/checkout/loader.js"></script>
</section>
